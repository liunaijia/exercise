package bytecode;

import java.io.DataInputStream;
import java.io.FileInputStream;
import java.io.IOException;

public class ClassFile {
	private U4 magic;
	private Version version;
	private ConstantPool constantPool;
	private AccessFlags accessFlags;
	private ConstantClassInfo thisClass;
	private ConstantClassInfo superClass;

	public ClassFile(String classFilePath) throws IOException {
		try (FileInputStream is = new FileInputStream(classFilePath)) {
			try (DataInputStream stream = new DataInputStream(is)) {
				magic = new U4(stream);
				version = new Version(stream);
				constantPool = new ConstantPool(stream);
				accessFlags = new AccessFlags(stream);
				thisClass = this.constantPool.getItem(new U2(stream).getValue());
				superClass = this.constantPool.getItem(new U2(stream).getValue());
			}
		}
	}

	@Override
	public String toString() {
		StringBuilder sb = new StringBuilder();
		sb.append(String.format("Magic: %s%n", magic))
				.append(String.format("Version: %s%n", version))
				.append(String.format("Constant pool: %n%s", constantPool))
				.append(String.format("Access Flags: %s%n", accessFlags))
				.append(String.format("This Class: %s%n", thisClass.getClassName(this.constantPool)))
				.append(String.format("Super Class: %s%n", superClass.getClassName(this.constantPool)))
				;
		return sb.toString();
	}

}
