package attributes;

import java.io.DataInputStream;
import java.io.IOException;

import bytecode.ByteCodeReader;
import bytecode.ConstantPool;
import bytecode.constantpool.ConstantDoubleInfo;
import bytecode.constantpool.ConstantFloatInfo;
import bytecode.constantpool.ConstantIntegerInfo;
import bytecode.constantpool.ConstantLongInfo;
import bytecode.constantpool.ConstantPoolInfo;

public class ConstantValueAttribute extends Attribute {
	private Object value;
	
	public ConstantValueAttribute(ByteCodeReader reader,
			ConstantPool constantPool) throws IOException {
		super(reader, constantPool);
	}

	@Override
	protected void read(ByteCodeReader reader, ConstantPool constantPool) throws IOException {
		// u2 constantvalue_index;
		ConstantPoolInfo poolInfo = constantPool.get(reader.read2u());
		// poolInfo只允许CONSTANT_Long、CONSTANT_Float、CONSTANT_Double、CONSTANT_Integer、CONSTANT_String类型
		if (poolInfo instanceof ConstantLongInfo)
			this.value = ((ConstantLongInfo)poolInfo).getValue();
		else if (poolInfo instanceof ConstantFloatInfo)
			this.value = ((ConstantFloatInfo)poolInfo).getValue();
		else if (poolInfo instanceof ConstantDoubleInfo)
			this.value = ((ConstantDoubleInfo)poolInfo).getValue();
		else if (poolInfo instanceof ConstantIntegerInfo)
			this.value = ((ConstantIntegerInfo)poolInfo).getValue();
	}

}
